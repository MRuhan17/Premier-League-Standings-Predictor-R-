# ==========================================
# train_rf_model.R
# ==========================================
# Trains a Random Forest regression model on
# Premier League feature data and saves rf_model.rds
# ==========================================

library(tidyverse)
library(data.table)
library(randomForest)

set.seed(42)

# Load engineered dataset
input_file <- "data/combined_features.csv"
if (!file.exists(input_file))
  stop("âŒ combined_features.csv not found! Run 01_feature_engineering.R first.")

df <- fread(input_file)
df <- df %>%
  mutate(across(where(is.numeric), ~ ifelse(is.na(.x), 0, .x)))

# Prepare training data
target <- df$points
features <- df %>%
  select(avg_xG, avg_xGA, goals_for, goals_against,
         goal_diff, wins, draws, losses)
train_matrix <- as.matrix(features)

# Train Random Forest model
rf_model <- randomForest(
  x = train_matrix,
  y = target,
  ntree = 500,
  mtry = 4,
  importance = TRUE
)

# Print quick feature importance
message("ðŸŒ² Random Forest training complete. Top features:")
print(head(importance(rf_model), 5))

# Save trained model
dir.create("models", showWarnings = FALSE)
saveRDS(rf_model, "models/rf_model.rds")

message("ðŸ’¾ Saved model -> models/rf_model.rds")

